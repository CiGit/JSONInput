"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("baobab")),n=require("react"),r=require("jsonschema"),o=require("baobab-react/higher-order"),a=function(){return new t({schema:{},value:{},status:{}})};function i(e){return function(){return n.createElement("span",null,"Widget for '"+e+"' was not defined")}}var u={};function c(e){return u[e]||i(e)}function s(e){u=Object.assign({},u,e)}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},v=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},d={};function y(e){var t=e.value,r=e.schema,o=e.schema.view,a={value:t,schema:r,children:e.children,editKey:e.editKey,path:e.path,onChange:e.onChange,onChildAdd:e.onChildAdd,onChildRemove:e.onChildRemove,addKey:e.addKey,removeKey:e.removeKey,alterKey:e.alterKey,errorMessage:e.errorMessage};if(o){var i=o.type;if("string"==typeof i){var u=c(i);return n.createElement(u,h({},a,{view:o}))}if("function"==typeof i){var s=i;return n.createElement(s,h({},a,{view:o}))}}var l=Array.isArray(r.type)?r.type.find(function(e){return"null"!==e}):r.type,p=void 0;return p=c(void 0===l?"undefinedType":l),n.createElement(p,h({},a,{view:o||d}))}var m=new r.Validator;function g(e,t,n){return m.validate(e,t,{formValue:n})}m.attributes.errored=function(e,t,n){if("function"!=typeof t.errored)throw new r.SchemaError('"errored" expects a function');var o=t.errored(e,n.formValue);if(o)return o};var b="value",C="status",E="state",w="errors",j=[];function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=[C].concat(t).concat([w]),o=e.select(r);n&&n.length&&Array.isArray(o.get())?(o.splice([0,o.get().length]),o.concat(n||[])):o.set(n||j)}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=new Map;n.forEach(function(e){var t=r.get(e.property)||[];t.push(e.message),r.set(e.property,t)}),K(e,t,j),r.forEach(function(n,r){K(e,t.concat(r.split(/\.|\[|\]/).filter(function(e){return""!==e}).slice(1)),n)})}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=arguments[3],o=[C].concat(t);e.set([b].concat(t),n),e.set(o.concat([E]),"dirty"),S(e,t,r)}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];e.set([b].concat(t),n),e.set([C].concat(t).concat([E]),"pristine")}function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.get([C].concat(t).concat([w]))||j}function D(e){return e.get(b)}function x(e){return function(t){return n.createElement(e,h({},t,{errorMessage:t.dispatch(P,t.path),onChange:function(e){var n=g(e,t.schema,t.dispatch(D));t.onChange(e,n.errors)}}))}}var R={};function M(e){var t=[],r=e.schema.properties||{},o=e.value||{},a=Object.keys(r);function i(e){if(r[e]){var t=r[e].index;if("number"==typeof t)return t}return 0}Object.keys(o).forEach(function(e){e in r||a.push(e)}),a.sort(function(e,t){return i(e)-i(t)});for(var u=0;u<a.length;u+=1){var c=a[u];if(c in r)t.push(n.createElement(re,h({},e,{status:e.status[c]||R,schema:r[c],value:o[c],editKey:c,key:u})));else{var s=e.schema.additionalProperties;t.push(n.createElement(re,h({},e,{status:e.status[c]||R,schema:s,value:o[c],editKey:c,key:u})))}}return t}function N(e){return n.createElement(y,h({},e,{addKey:function(t,n){var r;if("object"===l(e.value)&&t in e.value)throw new Error('Property "'+t+'" already exists');e.onChange(Object.assign({},e.value,((r={})[t]=n,r)))},removeKey:function(t){var n=Object.assign({},e.value);delete n[t],e.onChange(n)},alterKey:function(t,n){if(t!==n){if(n in e.value)throw new Error('Property "'+t+'" already exists');var r={};Object.keys(e.value).forEach(function(o){o!==t?r[o]=e.value[o]:r[n]=e.value[o]}),e.onChange(r)}}}),M(e))}var W=x(N);function k(e){return n.createElement(y,e)}var T=x(k),_=function(e){function t(n){p(this,t);var r=v(this,e.call(this,n));return r.state={value:n.value},r.boundChange=r.onChange.bind(r),r}return f(t,e),t.prototype.componentWillReceiveProps=function(e){Number(this.state.value)!==Number(e.value)&&this.setState({value:e.value})},t.prototype.onChange=function(e){var t=this,n=""===e?void 0:e,r=Number(n);this.setState({value:n},function(){return t.props.onChange(isNaN(r)?n:r)})},t.prototype.render=function(){return n.createElement(k,h({},this.props,{value:this.state.value,onChange:this.boundChange}))},t}(n.Component),q=x(_);function U(e){return n.createElement(y,e)}var V=x(U),z={};function B(e,t){return function(n){var r=t.value;r?t.onChange(r.map(function(t,r){return+r!=+e?t:n})):t.onChange([n])}}function F(e){return function(t){var n=e.value||[];e.onChange(n.filter(function(e,n){return Number(n)!==Number(t)}))}}function G(e){return function(t){var n=e.value||[];e.onChange(n.concat([t]))}}function H(e){var t=e.value,r=e.schema,o=r.value,a=r.items,i=[];return(t||(o||[])).forEach(function(t,r){return i.push(n.createElement(re,h({},e,{schema:Array.isArray(a)?a[r]||{}:a,value:t,editKey:String(r),status:e.status[String(r)]||z,key:r,onChange:B(r,e)})))}),i}function I(e){return n.createElement(y,h({},e,{onChildAdd:G(e),onChildRemove:F(e)}),H(e))}var J=x(I),L={object:W,string:T,number:q,boolean:V,array:J};function Q(e){return function(t){var r=t.schema.visible,o=t.value;try{if(r&&!r(o,t.dispatch(D),t.path.concat()))return null}catch(e){return null}return n.createElement(e,t)}}function X(e){return n.createElement("div",null,'Undefined field type "'+e.schema.type.toString()+'", ['+e.path.toString()+"]")}function Y(e){switch(void 0===e?"undefined":l(e)){case"number":return"number";case"string":return"string";case"boolean":return"boolean";case"object":return Array.isArray(e)?"array":"object";default:return"string"}}function Z(e,t){return void 0!==t?e.concat([t]):e}function $(e){return function(t){function r(e){p(this,r);var n=v(this,t.call(this,e)),o=e.schema||{};return"type"in o||(o=h({type:Y(e.value)},o)),n.state={schema:o},n.path=Z(n.props.path,n.props.editKey),n}return f(r,t),r.prototype.componentWillReceiveProps=function(e){if(e.editKey===this.props.editKey&&e.path===this.props.path||(this.path=Z(e.path,e.editKey)),this.props.schema!==e.schema){var t=e.schema||{};"type"in t||(t=h({type:Y(e.value)},t)),this.setState(function(){return{schema:t}})}},r.prototype.render=function(){return n.createElement(e,h({},this.props,{path:this.path,schema:this.state.schema}))},r}(n.Component)}function ee(e){var t=e.value,n=e.schema.value;return void 0!==t?t:n}function te(e){return function(t){function r(e){p(this,r);var n=v(this,t.call(this,e));return n.state={val:ee(e)},n.notifyDefaultChange(),n}return f(r,t),r.prototype.componentDidMount=function(){},r.prototype.componentWillReceiveProps=function(e){void 0===e.status.state?this.setState({val:ee(e)}):this.setState({val:e.value})},r.prototype.componentDidUpdate=function(){this.notifyDefaultChange()},r.prototype.notifyDefaultChange=function(){this.props.value!==this.state.val&&this.props.dispatch(A,this.props.path,this.state.val)},r.prototype.render=function(){return n.createElement(e,h({},this.props,{value:this.state.val}))},r}(n.Component)}var ne=function(e){function t(n){p(this,t);var r=v(this,e.call(this,n));return r.onChange=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];n.dispatch.apply(n,[O,r.props.path].concat(t))},r}return f(t,e),t.prototype.render=function(){var e=this.props.schema.type,t=Array.isArray(e)?e.find(function(e){return"null"!==e}):e,r=void 0;return void 0===(r=void 0===t||"null"===t?X:L[t])&&(r=X),n.createElement(r,h({},this.props,{onChange:this.onChange}))},t}(n.Component);ne.defaultProps={path:[]};var re=$(te(Q(ne))),oe=o.branch({schema:"schema",status:"status",value:"value"},re);function ae(){}var ie=function(e){function t(n){p(this,t);var r=v(this,e.call(this,n));return r.event=!1,r.tree=a(),r.updateTree(n.value,n.schema),r.rooted=o.root(r.tree,oe),r}return f(t,e),t.prototype.componentDidMount=function(){var e=this;this.tree.select("value").on("update",function(t){e.event&&e.props.onChange(t.data.currentData,g(t.data.currentData,e.tree.get("schema"),t.data.currentData).errors)})},t.prototype.componentWillReceiveProps=function(e){e.value===this.tree.get("value")&&e.schema===this.props.schema||this.updateTree(e.value,e.schema)},t.prototype.componentWillUnmount=function(){this.tree.release()},t.prototype.shouldComponentUpdate=function(){return!1},t.prototype.getValue=function(){return this.tree.get("value")},t.prototype.updateTree=function(e,t){this.event=!1,this.tree.set("value",e),this.tree.set("schema",t),this.tree.set("status",{}),this.tree.commit(),this.event=!0},t.prototype.validate=function(){var e=g(this.tree.get("value"),this.tree.get("schema"),this.tree.get("value"));return S(this.tree,[],e.errors),e.errors},t.prototype.render=function(){var e=this.rooted;return n.createElement(e,{onChange:ae,path:[]})},t}(n.Component);ie.defaultProps={schema:{}},exports.default=ie,exports.setDefaultWidgets=s;
//# sourceMappingURL=index.js.map
