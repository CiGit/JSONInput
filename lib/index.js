"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function t(e){return function(){return x.createElement("span",null,"Widget for '"+e+"' was not defined")}}function n(e){return k[e]||t(e)}function r(e){k=Object.assign({},k,e)}function o(e){var t=e.value,r=e.schema,o=e.schema.view,a={value:t,schema:r,children:e.children,editKey:e.editKey,path:e.path,onChange:e.onChange,onChildAdd:e.onChildAdd,onChildRemove:e.onChildRemove,addKey:e.addKey,removeKey:e.removeKey,alterKey:e.alterKey,errorMessage:e.errorMessage};if(o){var i=o.type;if("string"==typeof i){var u=n(i);return x.createElement(u,q({},a,{view:o}))}if("function"==typeof i){var c=i;return x.createElement(c,q({},a,{view:o}))}}var s=Array.isArray(r.type)?r.type.find(function(e){return"null"!==e}):r.type,l=void 0;return l=n(void 0===s?"undefinedType":s),x.createElement(l,q({},a,{view:o||z}))}function a(e,t,n){return B.validate(e,t,{formValue:n})}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=[G].concat(t).concat([I]),o=e.select(r);n&&n.length&&Array.isArray(o.get())?(o.splice([0,o.get().length]),o.concat(n||[])):o.set(n||J)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=new Map;n.forEach(function(e){var t=r.get(e.property)||[];t.push(e.message),r.set(e.property,t)}),i(e,t,J),r.forEach(function(n,r){i(e,t.concat(r.split(/\.|\[|\]/).filter(function(e){return""!==e}).slice(1)),n)})}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=arguments[3],o=[G].concat(t);e.set([F].concat(t),n),e.set(o.concat([H]),"dirty"),u(e,t,r)}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];e.set([F].concat(t),n),e.set([G].concat(t).concat([H]),"pristine")}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.get([G].concat(t).concat([I]))||J}function p(e){return e.get(F)}function h(e){return function(t){return x.createElement(e,q({},t,{errorMessage:t.dispatch(l,t.path),onChange:function(e){var n=a(e,t.schema,t.dispatch(p));t.onChange(e,n.errors)}}))}}function f(e){function t(e){if(r[e]){var t=r[e].index;if("number"==typeof t)return t}return 0}var n=[],r=e.schema.properties||{},o=e.value||{},a=Object.keys(r);Object.keys(o).forEach(function(e){e in r||a.push(e)}),a.sort(function(e,n){return t(e)-t(n)});for(var i=0;i<a.length;i+=1){var u=a[i];if(u in r)n.push(x.createElement(oe,q({},e,{status:e.status[u]||L,schema:r[u],value:o[u],editKey:u,key:i})));else{var c=e.schema.additionalProperties;n.push(x.createElement(oe,q({},e,{status:e.status[u]||L,schema:c,value:o[u],editKey:u,key:i})))}}return n}function v(e){return x.createElement(o,q({},e,{addKey:function(t,n){var r;if("object"===T(e.value)&&t in e.value)throw new Error('Property "'+t+'" already exists');e.onChange(Object.assign({},e.value,(r={},r[t]=n,r)))},removeKey:function(t){var n=Object.assign({},e.value);delete n[t],e.onChange(n)},alterKey:function(t,n){if(t!==n){if(n in e.value)throw new Error('Property "'+t+'" already exists');var r={};Object.keys(e.value).forEach(function(o){o!==t?r[o]=e.value[o]:r[n]=e.value[o]}),e.onChange(r)}}}),f(e))}function y(e){return x.createElement(o,e)}function d(e){return x.createElement(o,e)}function m(e,t){return function(n){var r=t.value;r?t.onChange(r.map(function(t,r){return+r!=+e?t:n})):t.onChange([n])}}function g(e){return function(t){var n=e.value||[];e.onChange(n.filter(function(e,n){return Number(n)!==Number(t)}))}}function b(e){return function(t){var n=e.value||[];e.onChange(n.concat([t]))}}function C(e){var t=e.value,n=e.schema,r=n.value,o=n.items,a=[];return(t||(r||[])).forEach(function(t,n){return a.push(x.createElement(oe,q({},e,{schema:Array.isArray(o)?o[n]||{}:o,value:t,editKey:String(n),status:e.status[String(n)]||ee,key:n,onChange:m(n,e)})))}),a}function E(e){return x.createElement(o,q({},e,{onChildAdd:b(e),onChildRemove:g(e)}),C(e))}function w(e){return function(t){var n=t.schema.visible,r=t.value;try{if(n&&!n(r,t.dispatch(p),t.path.concat()))return null}catch(e){return null}return x.createElement(e,t)}}function j(e){return x.createElement("div",null,'Undefined field type "'+e.schema.type.toString()+'", ['+e.path.toString()+"]")}function K(e){switch(void 0===e?"undefined":T(e)){case"number":return"number";case"string":return"string";case"boolean":return"boolean";case"object":return Array.isArray(e)?"array":"object";default:return"string"}}function S(e,t){return void 0!==t?e.concat([t]):e}function O(e){return function(t){function n(e){_(this,n);var r=V(this,t.call(this,e)),o=e.schema||{};return"type"in o||(o=q({type:K(e.value)},o)),r.state={schema:o},r.path=S(r.props.path,r.props.editKey),r}return U(n,t),n.prototype.componentWillReceiveProps=function(e){if(e.editKey===this.props.editKey&&e.path===this.props.path||(this.path=S(e.path,e.editKey)),this.props.schema!==e.schema){var t=e.schema||{};"type"in t||(t=q({type:K(e.value)},t)),this.setState(function(){return{schema:t}})}},n.prototype.render=function(){return x.createElement(e,q({},this.props,{path:this.path,schema:this.state.schema}))},n}(x.Component)}function A(e){var t=e.value,n=e.schema.value;return void 0!==t?t:n}function P(e){return function(t){function n(e){_(this,n);var r=V(this,t.call(this,e));return r.state={val:A(e)},r.notifyDefaultChange(),r}return U(n,t),n.prototype.componentDidMount=function(){},n.prototype.componentWillReceiveProps=function(e){void 0===e.status.state?this.setState({val:A(e)}):this.setState({val:e.value})},n.prototype.componentDidUpdate=function(){this.notifyDefaultChange()},n.prototype.notifyDefaultChange=function(){this.props.value!==this.state.val&&this.props.dispatch(s,this.props.path,this.state.val)},n.prototype.render=function(){return x.createElement(e,q({},this.props,{value:this.state.val}))},n}(x.Component)}function D(){}Object.defineProperty(exports,"__esModule",{value:!0});var x=require("react"),R=require("baobab-react/higher-order"),M=e(require("baobab")),N=require("jsonschema"),W=function(){return new M({schema:{},value:{},status:{}})},k={},T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},U=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},V=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},z={},B=new N.Validator;B.attributes.errored=function(e,t,n){if("function"!=typeof t.errored)throw new N.SchemaError('"errored" expects a function');var r=t.errored(e,n.formValue);if(r)return r};var F="value",G="status",H="state",I="errors",J=[],L={},Q=h(v),X=h(y),Y=function(e){function t(n){_(this,t);var r=V(this,e.call(this,n));return r.state={value:n.value},r.boundChange=r.onChange.bind(r),r}return U(t,e),t.prototype.componentWillReceiveProps=function(e){Number(this.state.value)!==Number(e.value)&&this.setState({value:e.value})},t.prototype.onChange=function(e){var t=this,n=""===e?void 0:e,r=Number(n);this.setState({value:n},function(){return t.props.onChange(isNaN(r)?n:r)})},t.prototype.render=function(){return x.createElement(y,q({},this.props,{value:this.state.value,onChange:this.boundChange}))},t}(x.Component),Z=h(Y),$=h(d),ee={},te=h(E),ne={object:Q,string:X,number:Z,boolean:$,array:te},re=function(e){function t(n){_(this,t);var r=V(this,e.call(this,n));return r.onChange=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];n.dispatch.apply(n,[c,r.props.path].concat(t))},r}return U(t,e),t.prototype.render=function(){var e=this.props.schema.type,t=Array.isArray(e)?e.find(function(e){return"null"!==e}):e,n=void 0;return n=void 0===t||"null"===t?j:ne[t],x.createElement(n,q({},this.props,{onChange:this.onChange}))},t}(x.Component);re.defaultProps={path:[]};var oe=O(P(w(re))),ae=R.branch({schema:"schema",status:"status",value:"value"},oe),ie=function(e){function t(n){_(this,t);var r=V(this,e.call(this,n));return r.tree=W(),r.updateTree(n.value,n.schema),r.rooted=R.root(r.tree,ae),r}return U(t,e),t.prototype.componentDidMount=function(){var e=this;this.tree.select("value").on("update",function(t){e.event&&e.props.onChange(t.data.currentData,a(t.data.currentData,e.tree.get("schema"),t.data.currentData).errors)})},t.prototype.componentWillReceiveProps=function(e){e.value===this.tree.get("value")&&e.schema===this.props.schema||this.updateTree(e.value,e.schema)},t.prototype.componentWillUnmount=function(){this.tree.release()},t.prototype.shouldComponentUpdate=function(){return!1},t.prototype.getValue=function(){return this.tree.get("value")},t.prototype.updateTree=function(e,t){this.event=!1,this.tree.set("value",e),this.tree.set("schema",t),this.tree.set("status",{}),this.tree.commit(),this.event=!0},t.prototype.validate=function(){var e=a(this.tree.get("value"),this.tree.get("schema"),this.tree.get("value"));return u(this.tree,[],e.errors),e.errors},t.prototype.render=function(){var e=this.rooted;return x.createElement(e,{onChange:D,path:[]})},t}(x.Component);ie.defaultProps={schema:{}},exports.default=ie,exports.setDefaultWidgets=r;
//# sourceMappingURL=index.js.map
