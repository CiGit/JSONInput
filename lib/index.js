!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("baobab"),require("jsonschema")):"function"==typeof define&&define.amd?define(["exports","react","baobab","jsonschema"],t):t(e.jsoninput=e.jsoninput||{},e.React,e.require$$2,e.jsonschema)}(this,function(e,t,n,r){"use strict";function a(e,t){return t={exports:{}},e(t,t.exports),t.exports}function o(e){var t=e.value,n=e.path,r=e.actions,a=e.schema.value,o=void 0!==t?t:a;t!==o&&r.setDefaultValue(n,o)}function u(e){var n=function(n){function r(e){ue(this,r);var t=he(this,Object.getPrototypeOf(r).call(this,e));return o(e),t}return se(r,n),ce(r,[{key:"componentWillReceiveProps",value:function(e){o(e)}},{key:"render",value:function(){return t.createElement(e,this.props)}}]),r}(t.Component);return n}function c(e){return function(){return t.createElement("span",null,"Widget for '"+e+"' was not defined")}}function i(e){function n(n){var r=n.schema.required,a=r?"required":"";return t.createElement("div",null,t.createElement("label",{className:n.schema.type+"Field "+a},t.createElement("span",{className:"title"},n.view.title||n.editKey),t.createElement(e,n),t.createElement("span",null,n.view.description),t.createElement("span",null,n.errorMessage)))}return n}function l(e){return function(t){e("checkbox"===t.target.type?t.target.checked:t.target.value)}}function s(e){return t.createElement("input",{type:e.type,placeholder:e.schema.placeholder,value:e.value,className:e.className,onChange:l(e.onChange),checked:e.checked})}function f(e){return t.createElement(s,le({},e,{type:"string"}))}function h(e){return t.createElement(s,le({},e,{type:"number"}))}function p(e){return t.createElement(s,le({},e,{type:"checkbox",checked:e.value}))}function v(e){function n(n,r){return t.createElement("div",null,t.createElement("span",{onClick:e.onChildRemove(r)},"-"),n)}var r=t.Children.map(e.children,n);return t.createElement("div",null,t.createElement("div",null,r),t.createElement("span",{onClick:e.onChildAdd},"+"))}function d(e){return t.createElement("div",null,e.children)}function y(e){var n=e.view,r=e.value,a=e.onChange,o=n.choices.map(function(e){return t.createElement("option",{key:e.value,value:e.value},e.label)});return t.createElement("select",{value:r,onChange:function(e){return a(e.target.value)}},o)}function m(e){return be[e]||c(e)}function b(e){be=Object.assign({},be,e)}function g(e){var n=e.schema,r=n.view,a=fe(n,["view"]);if(r){var o=r.type;if("string"==typeof o){var u=m(o);return t.createElement(u,le({},e,{schema:a,view:r}))}if("function"==typeof o){var c=o;return t.createElement(c,le({},e,{schema:a,view:r}))}}var i=Array.isArray(n.type)?n.type.find(function(e){return"null"!==e}):n.type,l=m(i);return t.createElement(l,le({},e,{schema:a,view:r||ge}))}function E(e,t,n){return Ee.validate(e,t,{formValue:n})}function j(e){function n(n){function r(e){var t=E(e,n.schema,n.actions.getFormValue()),r=t.errors.map(function(e){return e.message});n.onChange(e,r)}return t.createElement(e,le({},n,{errorMessage:n.actions.getErrors(n.path),onChange:r}))}return n}function C(e){function n(e,t){var n=a[e]?a[e].index||0:0,r=a[t]?a[t].index||0:0;return n-r}var r=[],a=e.schema.properties||{},o=e.value||{},u=Object.keys(a);Object.keys(o).forEach(function(e){e in a||u.push(e)}),u.sort(n);for(var c=0;c<u.length;c+=1){var i=u[c];if(i in a)r.push(t.createElement(Ae,le({},e,{schema:a[i],value:o[i],editKey:i,key:i})));else{var l=e.schema.defaultProperties;r.push(t.createElement(Ae,le({},e,{schema:l,value:o[i],editKey:i,key:i})))}}return r}function w(e){function n(t,n){e.onChange(Object.assign({},e.value,ie({},t,n)))}function r(t){var n=Object.assign({},e.value);delete n[t],e.onChange(n)}function a(t,n){var r={};Object.keys(e.value).forEach(function(a){a!==t?r[a]=e.value[a]:r[n]=e.value[a]}),e.onChange(r)}return t.createElement(g,le({},e,{addKey:n,removeKey:r,alterKey:a}),C(e))}function O(e){var n=void 0!==e.value&&null!==e.value?String(e.value):e.value;return t.createElement(g,le({},e,{value:n}))}function k(e){return t.createElement(g,e)}function P(e,t){return function(n){var r=t.value;r?t.onChange(r.map(function(t,r){return+r!==+e?t:n})):t.onChange([n])}}function _(e){return function(t){return function(){var n=e.value||[];e.onChange(n.filter(function(e,n){return Number(n)!==Number(t)}))}}}function x(e){return function(){var t=e.value||[];e.onChange(t.concat([void 0]))}}function A(e){var n=e.value,r=e.schema,a=r.defaultValue,o=r.items,u=void 0;u=n?n:a?a:[];var c=[];return u.forEach(function(n,r){return c.push(t.createElement(Ae,le({},e,{schema:o,value:n,editKey:String(r),key:r,onChange:P(r,e)})))}),c}function N(e){return t.createElement(g,le({},e,{onChildAdd:x(e),onChildRemove:_(e)}),A(e))}function S(e){function n(n){var r=n.schema.visible,a=n.value;return r&&!r(a,n.actions.getFormValue())?null:t.createElement(e,n)}return n}function M(e){return t.createElement("span",null,'Undefined field type "'+e.schema.type+'", ['+e.path+"]")}function R(e){switch("undefined"==typeof e?"undefined":oe(e)){case"number":return"number";case"string":return"string";case"boolean":return"boolean";case"object":return Array.isArray(e)?"array":"object";default:return"string"}}function T(e,t){return t?e.concat([t]):e}function V(e){function n(n){var r=n.schema,a=T(n.path,n.editKey),o=r;return o&&"type"in o||(o={type:R(n.value)}),t.createElement(e,le({},n,{path:a,schema:o}))}return n}function W(e,t){return function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];e.apply(void 0,[t].concat(r))}}function K(e,t,n){var r=[Se].concat(t).concat([Re]),a=e.select(r);n&&n.length&&Array.isArray(a.get())?(a.splice([0,a.get().length]),a.concat(n||[])):a.set(n||Te)}function D(e,t,n,r){var a=[Se].concat(t);e.set([Ne].concat(t),n),e.set(a.concat([Me]),"dirty"),K(e,t,r)}function I(e,t,n){e.set([Ne].concat(t),n),e.set([Se].concat(t).concat([Me]),"pristine")}function q(e,t){return e.get([Se].concat(t).concat([Me]))}function U(e,t){return e.get([Se].concat(t).concat([Re]))||Te}function F(e){return e.get(Ne)}function B(e,t,n){var r=t.reduce(function(t,n){return"object"===e.get(t).type?t.concat(["properties",n]):"array"===e.get(t).type?t.concat(["items"]):t.concat([n])},["schema"]);e.set(r,n)}t="default"in t?t.default:t,n="default"in n?n.default:n;var $="default"in r?r.default:r,z=a(function(e,t){function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return"prop type `"+e+"` is invalid; it must be "+t+"."}Object.defineProperty(t,"__esModule",{value:!0});var o=n,u=r(o);t.default={baobab:function(e,t){if(t in e)return e[t]instanceof u.default?void 0:new Error(a(t,"a Baobab tree"))}}}),G=z&&"object"==typeof z&&"default"in z?z.default:z,H=a(function(e,t){function n(e,t){return function n(){for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return a.length>=t?e.apply(null,a):function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(null,a.concat(t))}}}function r(e,t,n){return"function"==typeof e&&(e=e(t,n)),e}Object.defineProperty(t,"__esModule",{value:!0}),t.curry=n,t.solveMapping=r}),J=H&&"object"==typeof H&&"default"in H?H.default:H,L=a(function(e,r){function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){return e.name||e.displayName||"Component"}function l(e,t){throw j('baobab-react/higher-order.branch: given cursors mapping is invalid (check the "'+e+'" component).',{mapping:t})}function s(e,t){if(!(e instanceof m.default))throw j("baobab-react/higher-order.root: given tree is not a Baobab.",{target:e});if("function"!=typeof t)throw Error("baobab-react/higher-order.root: given target is not a valid React component.");var n=i(t),r=function(n){function r(){return o(this,r),u(this,Object.getPrototypeOf(r).apply(this,arguments))}return c(r,n),p(r,[{key:"getChildContext",value:function(){return{tree:e}}},{key:"render",value:function(){return d.default.createElement(t,this.props)}}]),r}(d.default.Component);return r.displayName="Rooted"+n,r.childContextTypes={tree:E.default.baobab},r}function f(e,t){if("function"!=typeof t)throw Error("baobab-react/higher-order.branch: given target is not a valid React component.");var n=i(t);C(e)||"function"==typeof e||l(n,e);var r=function(r){function a(t,r){o(this,a);var c=u(this,Object.getPrototypeOf(a).call(this,t,r));if(e){var i=(0,b.solveMapping)(e,t,r);i||l(n,i),c.watcher=c.context.tree.watch(i),c.state=c.watcher.get()}return c}return c(a,r),p(a,[{key:"getDecoratedComponentInstance",value:function(){return this.decoratedComponentInstance}},{key:"handleChildRef",value:function(e){this.decoratedComponentInstance=e}}]),p(a,[{key:"componentWillMount",value:function(){var e=this;if(this.dispatcher=function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return t.apply(void 0,[e.context.tree].concat(r))},this.watcher){var t=function(){e.watcher&&e.setState(e.watcher.get())};this.watcher.on("update",t)}}},{key:"render",value:function(){var e={dispatch:this.dispatcher};return d.default.createElement(t,h({},this.props,e,this.state,{ref:this.handleChildRef.bind(this)}))}},{key:"componentWillUnmount",value:function(){this.watcher&&(this.watcher.release(),this.watcher=null)}},{key:"componentWillReceiveProps",value:function(t){if(this.watcher&&"function"==typeof e){var r=(0,b.solveMapping)(e,t,this.context);r||l(n,r),this.watcher.refresh(r),this.setState(this.watcher.get())}}}]),a}(d.default.Component);return r.displayName="Branched"+n,r.contextTypes={tree:E.default.baobab},r}Object.defineProperty(r,"__esModule",{value:!0}),r.branch=r.root=void 0;var h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),v=t,d=a(v),y=n,m=a(y),b=J,g=G,E=a(g),j=m.default.helpers.makeError,C=m.default.type.object,w=(0,b.curry)(s,2),O=(0,b.curry)(f,2);r.root=w,r.branch=O}),Q=L&&"object"==typeof L&&"default"in L?L.default:L,X=a(function(e,t){var n=Q;t.root=n.root,t.branch=n.branch}),Y=X.branch,Z=X.root,ee=function(){return new n({schema:{},value:{},status:{}})},te=a(function(e,t){function n(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(t),o=0;o<n.length;o++)if(!a(n[o])||e[n[o]]!==t[n[o]])return!1;return!0}t.__esModule=!0,t.default=n,e.exports=t.default}),ne=te&&"object"==typeof te&&"default"in te?te.default:te,re=a(function(e,t){function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){return!(0,o.default)(this.props,e)||!(0,o.default)(this.state,t)}t.__esModule=!0,t.default=r;var a=ne,o=n(a);e.exports=t.default}),ae=re&&"object"==typeof re&&"default"in re?re.default:re,oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},ue=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ce=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ie=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},se=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},fe=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},he=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},pe=i(f),ve=i(h),de=i(p),ye=i(v),me=i(d),be={string:pe,number:pe,boolean:de,array:ye,object:me,arrowNumber:ve,select:y},ge={},Ee=new r.Validator;Ee.attributes.errored=function(e,t,n){if("function"!=typeof t.errored)throw new $.SchemaError('"errored" expects a function');var r=t.errored(e,n.formValue);if(r)return r};var je=j(u(w)),Ce=j(u(O)),we=function(e){function n(e){ue(this,n);var t=he(this,Object.getPrototypeOf(n).call(this,e));return t.state={value:e.value},t.boundChange=t.onChange.bind(t),t}return se(n,e),ce(n,[{key:"componentWillReceiveProps",value:function(e){Number(this.state.value)!==Number(e.value)&&this.setState({value:e.value})}},{key:"onChange",value:function(e){var t=this,n=""===e?void 0:e,r=Number(n);this.setState({value:n},function(){return t.props.onChange(isNaN(r)?n:r)})}},{key:"render",value:function(){return t.createElement(O,le({},this.props,{value:this.state.value,onChange:this.boundChange}))}}]),n}(t.Component),Oe=j(u(we)),ke=j(u(k)),Pe=u(N),_e={object:je,string:Ce,number:Oe,boolean:ke,array:Pe},xe=function(e){function n(e){ue(this,n);var t=he(this,Object.getPrototypeOf(n).call(this,e));return t.onChange=W(e.actions.update,e.path),t}return se(n,e),ce(n,[{key:"shouldComponentUpdate",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return ae.apply(this,t)}},{key:"render",value:function(){var e=this.props.schema.type,n=Array.isArray(e)?e.find(function(e){return"null"!==e}):e,r=_e[n]||M;return t.createElement(r,le({},this.props,{onChange:this.onChange}))}}]),n}(t.Component),Ae=V(S(xe)),Ne="value",Se="status",Me="state",Re="errors",Te=[],Ve=Object.freeze({setErrors:K,update:D,setDefaultValue:I,getStatus:q,getErrors:U,getFormValue:F,updateSchema:B}),We=Y({schema:"schema",status:"status",value:"value"},Ae),Ke=function(e){function n(e){ue(this,n);var t=he(this,Object.getPrototypeOf(n).call(this,e));return t.tree=ee(),t.updateTree(e.value,e.schema),t.ACTIONS={},Object.keys(Ve).forEach(function(e){t.ACTIONS[e]=Ve[e].bind(t.tree,t.tree)}),t.rooted=Z(t.tree,We),t}return se(n,e),ce(n,[{key:"componentWillReceiveProps",value:function(e){this.updateTree(e.value,e.schema)}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentWillUnmount",value:function(){this.tree.release()}},{key:"getValue",value:function(){return this.tree.get("value")}},{key:"updateTree",value:function(e,t){var n=this;this.tree.select("value").release(),this.tree.select("value").set(e),this.tree.select("schema").set(t),this.tree.select("status").release(),this.tree.commit(),this.tree.select("value").on("update",function(e){return n.props.onChange(e.data.currentData,E(e.data.currentData,n.tree.get("schema"),e.data.currentData).errors)})}},{key:"validate",value:function(){var e=E(this.tree.get("value"),this.tree.get("schema"),this.tree.get("value")),t=this.ACTIONS.setErrors,n=new Map;return e.errors.forEach(function(e){var t=n.get(e.property)||[];t.push(e.message),n.set(e.property,t)}),n.forEach(function(e,n){t(n.split(/\.|\[|\]/).filter(function(e){return""!==e}).slice(1),e)}),e.errors}},{key:"render",value:function(){var e=this.rooted;return t.createElement(e,{onChange:this.props.onChange,path:[],actions:this.ACTIONS})}}]),n}(t.Component);e.default=Ke,e.setDefaultWidgets=b,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
