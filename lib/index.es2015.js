function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}function updateDefault(e){var t=e.value,r=e.path,n=e.actions,a=e.schema.value,o=void 0!==t?t:a;return t!==o&&n.setDefaultValue(r,o),o}function fromDefaultValue(t){var r=function(r){function n(e){classCallCheck(this,n);var t=possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e));return t.state={val:updateDefault(e)},t}return inherits(n,r),createClass(n,[{key:"componentWillReceiveProps",value:function(e){this.setState({val:updateDefault(e)})}},{key:"render",value:function(){return e.createElement(t,_extends({},this.props,{value:this.state.val}))}}]),n}(e.Component);return r}function undefinedWidgetFactory(t){return function(){return e.createElement("span",null,"Widget for '"+t+"' was not defined")}}function labeled(t){function r(r){var n=r.schema.required,a=n?"required":"";return e.createElement("div",null,e.createElement("label",{className:r.schema.type+"Field "+a},e.createElement("span",{className:"title"},r.view.title||r.editKey),e.createElement(t,r),e.createElement("span",null,r.view.description),e.createElement("span",null,r.errorMessage)))}return r}function onInputChange(e){return function(t){e("checkbox"===t.target.type?t.target.checked:t.target.value)}}function Input(t){return e.createElement("input",{type:t.type,placeholder:t.schema.placeholder,value:t.value,className:t.className,onChange:onInputChange(t.onChange),checked:t.checked})}function TextWidget(t){return e.createElement(Input,_extends({},t,{type:"string"}))}function ArrowNumberWidget(t){return e.createElement(Input,_extends({},t,{type:"number"}))}function CheckboxWidget(t){return e.createElement(Input,_extends({},t,{type:"checkbox",checked:t.value}))}function ArrayWidget(t){function r(r,n){return e.createElement("div",null,e.createElement("span",{onClick:t.onChildRemove(n)},"-"),r)}var n=e.Children.map(t.children,r);return e.createElement("div",null,e.createElement("div",null,n),e.createElement("span",{onClick:t.onChildAdd},"+"))}function ObjectWidget(t){return e.createElement("div",null,t.children)}function SelectWidget(t){var r=t.view,n=t.value,a=t.onChange,o=r.choices.map(function(t){return e.createElement("option",{key:t.value,value:t.value},t.label)});return e.createElement("select",{value:n,onChange:function(e){return a(e.target.value)}},o)}function defaultWidget(e){return DefaultWidget[e]||undefinedWidgetFactory(e)}function setDefaultWidgets(e){DefaultWidget=Object.assign({},DefaultWidget,e)}function Widget(t){var r=t.schema,n=r.view,a=objectWithoutProperties(r,["view"]);if(n){var o=n.type;if("string"==typeof o){var u=defaultWidget(o);return e.createElement(u,_extends({},t,{schema:a,view:n}))}if("function"==typeof o){var i=o;return e.createElement(i,_extends({},t,{schema:a,view:n}))}}var c=Array.isArray(r.type)?r.type.find(function(e){return"null"!==e}):r.type,l=defaultWidget(c);return e.createElement(l,_extends({},t,{schema:a,view:n||EMPTYOBJECT}))}function validate(e,t,r){return customValidator.validate(e,t,{formValue:r})}function validated(t){function r(r){function n(e){var t=validate(e,r.schema,r.actions.getFormValue()),n=t.errors.map(function(e){return e.message});r.onChange(e,n)}return e.createElement(t,_extends({},r,{errorMessage:r.actions.getErrors(r.path),onChange:n}))}return r}function renderChildren(t){function r(e,t){var r=a[e]?a[e].index||0:0,n=a[t]?a[t].index||0:0;return r-n}var n=[],a=t.schema.properties||{},o=t.value||{},u=Object.keys(a);Object.keys(o).forEach(function(e){e in a||u.push(e)}),u.sort(r);for(var i=0;i<u.length;i+=1){var c=u[i];if(c in a)n.push(e.createElement(SchemaType$1,_extends({},t,{schema:a[c],value:o[c],editKey:c,key:c})));else{var l=t.schema.defaultProperties;n.push(e.createElement(SchemaType$1,_extends({},t,{schema:l,value:o[c],editKey:c,key:c})))}}return n}function ObjectField(t){function r(e,r){t.onChange(Object.assign({},t.value,defineProperty({},e,r)))}function n(e){var r=Object.assign({},t.value);delete r[e],t.onChange(r)}function a(e,r){var n={};Object.keys(t.value).forEach(function(a){a!==e?n[a]=t.value[a]:n[r]=t.value[a]}),t.onChange(n)}return e.createElement(Widget,_extends({},t,{addKey:r,removeKey:n,alterKey:a}),renderChildren(t))}function SimpleStringField(t){var r=void 0!==t.value&&null!==t.value?String(t.value):t.value;return e.createElement(Widget,_extends({},t,{value:r}))}function BooleanField(t){return e.createElement(Widget,t)}function onChildChange(e,t){return function(r){var n=t.value;n?t.onChange(n.map(function(t,n){return+n!==+e?t:r})):t.onChange([r])}}function onChildRemove(e){return function(t){return function(){var r=e.value||[];e.onChange(r.filter(function(e,r){return Number(r)!==Number(t)}))}}}function onChildAdd(e){return function(){var t=e.value||[];e.onChange(t.concat([void 0]))}}function renderChildren$1(t){var r=t.value,n=t.schema,a=n.defaultValue,o=n.items,u=void 0;u=r?r:a?a:[];var i=[];return u.forEach(function(r,n){return i.push(e.createElement(SchemaType$1,_extends({},t,{schema:Array.isArray(o)?o[n]||{}:o,value:r,editKey:String(n),key:n,onChange:onChildChange(n,t)})))}),i}function ArrayField(t){return e.createElement(Widget,_extends({},t,{onChildAdd:onChildAdd(t),onChildRemove:onChildRemove(t)}),renderChildren$1(t))}function visibility(t){function r(r){var n=r.schema.visible,a=r.value;return n&&!n(a,r.actions.getFormValue())?null:e.createElement(t,r)}return r}function Undefined(t){return e.createElement("span",null,'Undefined field type "'+t.schema.type+'", ['+t.path+"]")}function infer(e){switch("undefined"==typeof e?"undefined":_typeof(e)){case"number":return"number";case"string":return"string";case"boolean":return"boolean";case"object":return Array.isArray(e)?"array":"object";default:return"string"}}function updatePath(e,t){return t?e.concat([t]):e}function inference(t){function r(r){var n=r.schema,a=updatePath(r.path,r.editKey),o=n;return o&&"type"in o||(o={type:infer(r.value)}),e.createElement(t,_extends({},r,{path:a,schema:o}))}return r}function doAction(e,t){return function(){for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];e.apply(void 0,[t].concat(n))}}function setErrors(e,t,r){var n=[STATUS].concat(t).concat([ERRORS]),a=e.select(n);r&&r.length&&Array.isArray(a.get())?(a.splice([0,a.get().length]),a.concat(r||[])):a.set(r||NOERRORS)}function update(e,t,r,n){var a=[STATUS].concat(t);e.set([VALUE].concat(t),r),e.set(a.concat([STATE]),"dirty"),setErrors(e,t,n)}function setDefaultValue(e,t,r){e.set([VALUE].concat(t),r),e.set([STATUS].concat(t).concat([STATE]),"pristine")}function getStatus(e,t){return e.get([STATUS].concat(t).concat([STATE]))}function getErrors(e,t){return e.get([STATUS].concat(t).concat([ERRORS]))||NOERRORS}function getFormValue(e){return e.get(VALUE)}function updateSchema(e,t,r){var n=t.reduce(function(t,r){return"object"===e.get(t).type?t.concat(["properties",r]):"array"===e.get(t).type?t.concat(["items"]):t.concat([r])},["schema"]);e.set(n,r)}import e from"react";import t from"baobab";import r,{Validator as n}from"jsonschema";var propTypes=createCommonjsModule(function(e,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return"prop type `"+e+"` is invalid; it must be "+t+"."}Object.defineProperty(r,"__esModule",{value:!0});var o=t,u=n(o);r.default={baobab:function(e,t){if(t in e)return e[t]instanceof u.default?void 0:new Error(a(t,"a Baobab tree"))}}}),require$$0$1=propTypes&&"object"==typeof propTypes&&"default"in propTypes?propTypes.default:propTypes,helpers=createCommonjsModule(function(e,t){"use strict";function r(e,t){return function r(){for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return a.length>=t?e.apply(null,a):function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.apply(null,a.concat(t))}}}function n(e,t,r){return"function"==typeof e&&(e=e(t,r)),e}Object.defineProperty(t,"__esModule",{value:!0}),t.curry=r,t.solveMapping=n}),require$$1=helpers&&"object"==typeof helpers&&"default"in helpers?helpers.default:helpers,higherOrder$2=createCommonjsModule(function(r,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e){return e.name||e.displayName||"Component"}function l(e,t){throw E('baobab-react/higher-order.branch: given cursors mapping is invalid (check the "'+e+'" component).',{mapping:t})}function s(e,t){if(!(e instanceof y.default))throw E("baobab-react/higher-order.root: given tree is not a Baobab.",{target:e});if("function"!=typeof t)throw Error("baobab-react/higher-order.root: given target is not a valid React component.");var r=c(t),n=function(r){function n(){return o(this,n),u(this,Object.getPrototypeOf(n).apply(this,arguments))}return i(n,r),h(n,[{key:"getChildContext",value:function(){return{tree:e}}},{key:"render",value:function(){return v.default.createElement(t,this.props)}}]),n}(v.default.Component);return n.displayName="Rooted"+r,n.childContextTypes={tree:C.default.baobab},n}function f(e,t){if("function"!=typeof t)throw Error("baobab-react/higher-order.branch: given target is not a valid React component.");var r=c(t);O(e)||"function"==typeof e||l(r,e);var n=function(n){function a(t,n){o(this,a);var i=u(this,Object.getPrototypeOf(a).call(this,t,n));if(e){var c=(0,g.solveMapping)(e,t,n);c||l(r,c),i.watcher=i.context.tree.watch(c),i.state=i.watcher.get()}return i}return i(a,n),h(a,[{key:"getDecoratedComponentInstance",value:function(){return this.decoratedComponentInstance}},{key:"handleChildRef",value:function(e){this.decoratedComponentInstance=e}}]),h(a,[{key:"componentWillMount",value:function(){var e=this;if(this.dispatcher=function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return t.apply(void 0,[e.context.tree].concat(n))},this.watcher){var t=function(){e.watcher&&e.setState(e.watcher.get())};this.watcher.on("update",t)}}},{key:"render",value:function(){var e={dispatch:this.dispatcher};return v.default.createElement(t,d({},this.props,e,this.state,{ref:this.handleChildRef.bind(this)}))}},{key:"componentWillUnmount",value:function(){this.watcher&&(this.watcher.release(),this.watcher=null)}},{key:"componentWillReceiveProps",value:function(t){if(this.watcher&&"function"==typeof e){var n=(0,g.solveMapping)(e,t,this.context);n||l(r,n),this.watcher.refresh(n),this.setState(this.watcher.get())}}}]),a}(v.default.Component);return n.displayName="Branched"+r,n.contextTypes={tree:C.default.baobab},n}Object.defineProperty(n,"__esModule",{value:!0}),n.branch=n.root=void 0;var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},h=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),p=e,v=a(p),m=t,y=a(m),g=require$$1,b=require$$0$1,C=a(b),E=y.default.helpers.makeError,O=y.default.type.object,j=(0,g.curry)(s,2),S=(0,g.curry)(f,2);n.root=j,n.branch=S}),require$$0=higherOrder$2&&"object"==typeof higherOrder$2&&"default"in higherOrder$2?higherOrder$2.default:higherOrder$2,higherOrder=createCommonjsModule(function(e,t){var r=require$$0;t.root=r.root,t.branch=r.branch}),branch=higherOrder.branch,root=higherOrder.root,createTree=function(){return new t({schema:{},value:{},status:{}})},shallowEqual=createCommonjsModule(function(e,t){"use strict";function r(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(t),o=0;o<r.length;o++)if(!a(r[o])||e[r[o]]!==t[r[o]])return!1;return!0}t.__esModule=!0,t.default=r,e.exports=t.default}),require$$0$2=shallowEqual&&"object"==typeof shallowEqual&&"default"in shallowEqual?shallowEqual.default:shallowEqual,_function=createCommonjsModule(function(e,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){return!(0,o.default)(this.props,e)||!(0,o.default)(this.state,t)}t.__esModule=!0,t.default=n;var a=require$$0$2,o=r(a);e.exports=t.default}),shouldPureComponentUpdate=_function&&"object"==typeof _function&&"default"in _function?_function.default:_function,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),defineProperty=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},objectWithoutProperties=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},TextWidget$1=labeled(TextWidget),ArrowNumberWidget$1=labeled(ArrowNumberWidget),CheckboxWidget$1=labeled(CheckboxWidget),ArrayWidget$1=labeled(ArrayWidget),ObjectWidget$1=labeled(ObjectWidget),DefaultWidget={string:TextWidget$1,number:TextWidget$1,boolean:CheckboxWidget$1,array:ArrayWidget$1,object:ObjectWidget$1,arrowNumber:ArrowNumberWidget$1,select:SelectWidget},EMPTYOBJECT={},customValidator=new r.Validator;customValidator.attributes.errored=function(e,t,r){if("function"!=typeof t.errored)throw new jsonschema__default.SchemaError('"errored" expects a function');var n=t.errored(e,r.formValue);if(n)return n};var ObjectField$1=validated(fromDefaultValue(ObjectField)),StringField=validated(fromDefaultValue(SimpleStringField)),NumberField=function(t){function r(e){classCallCheck(this,r);var t=possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t.state={value:e.value},t.boundChange=t.onChange.bind(t),t}return inherits(r,t),createClass(r,[{key:"componentWillReceiveProps",value:function(e){Number(this.state.value)!==Number(e.value)&&this.setState({value:e.value})}},{key:"onChange",value:function(e){var t=this,r=""===e?void 0:e,n=Number(r);this.setState({value:r},function(){return t.props.onChange(isNaN(n)?r:n)})}},{key:"render",value:function(){return e.createElement(SimpleStringField,_extends({},this.props,{value:this.state.value,onChange:this.boundChange}))}}]),r}(e.Component),NumberField$1=validated(fromDefaultValue(NumberField)),BooleanField$1=validated(fromDefaultValue(BooleanField)),ArrayField$1=fromDefaultValue(ArrayField),Fields={object:ObjectField$1,string:StringField,number:NumberField$1,boolean:BooleanField$1,array:ArrayField$1},SchemaType=function(t){function r(e){classCallCheck(this,r);var t=possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t.onChange=doAction(e.actions.update,e.path),t}return inherits(r,t),createClass(r,[{key:"shouldComponentUpdate",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return shouldPureComponentUpdate.apply(this,t)}},{key:"render",value:function(){var t=this.props.schema.type,r=Array.isArray(t)?t.find(function(e){return"null"!==e}):t,n=Fields[r]||Undefined;return e.createElement(n,_extends({},this.props,{onChange:this.onChange}))}}]),r}(e.Component),SchemaType$1=inference(visibility(SchemaType)),VALUE="value",STATUS="status",STATE="state",ERRORS="errors",NOERRORS=[],actions=Object.freeze({setErrors:setErrors,update:update,setDefaultValue:setDefaultValue,getStatus:getStatus,getErrors:getErrors,getFormValue:getFormValue,updateSchema:updateSchema}),actions=Object.freeze({setErrors:setErrors,update:update,setDefaultValue:setDefaultValue,getStatus:getStatus,getErrors:getErrors,getFormValue:getFormValue,updateSchema:updateSchema}),BranchedSchemaType=branch({schema:"schema",status:"status",value:"value"},SchemaType$1),Container=function(t){function r(e){classCallCheck(this,r);var t=possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e));return t.tree=createTree(),t.updateTree(e.value,e.schema),t.ACTIONS={},Object.keys(actions).forEach(function(e){t.ACTIONS[e]=actions[e].bind(t.tree,t.tree)}),t.rooted=root(t.tree,BranchedSchemaType),t}return inherits(r,t),createClass(r,[{key:"componentWillReceiveProps",value:function(e){this.updateTree(e.value,e.schema)}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentWillUnmount",value:function(){this.tree.release()}},{key:"getValue",value:function(){return this.tree.get("value")}},{key:"updateTree",value:function(e,t){var r=this;this.tree.select("value").release(),this.tree.select("value").set(e),this.tree.select("schema").set(t),this.tree.select("status").release(),this.tree.commit(),this.tree.select("value").on("update",function(e){return r.props.onChange(e.data.currentData,validate(e.data.currentData,r.tree.get("schema"),e.data.currentData).errors)})}},{key:"validate",value:function(){var e=validate(this.tree.get("value"),this.tree.get("schema"),this.tree.get("value")),t=this.ACTIONS.setErrors,r=new Map;return e.errors.forEach(function(e){var t=r.get(e.property)||[];t.push(e.message),r.set(e.property,t)}),r.forEach(function(e,r){t(r.split(/\.|\[|\]/).filter(function(e){return""!==e}).slice(1),e)}),e.errors}},{key:"render",value:function(){var t=this.rooted;return e.createElement(t,{onChange:this.props.onChange,path:[],actions:this.ACTIONS})}}]),r}(e.Component);Container.setDefaultWidgets=setDefaultWidgets;export default Container;
//# sourceMappingURL=index.es2015.js.map
