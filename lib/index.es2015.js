function t(t){return function(){return R("span",null,"Widget for '"+t+"' was not defined")}}function e(e){return U[e]||t(e)}function n(t){U=Object.assign({},U,t)}function r(t){var n=t.value,r=t.schema,o=t.schema.view,a={value:n,schema:r,children:t.children,editKey:t.editKey,path:t.path,onChange:t.onChange,onChildAdd:t.onChildAdd,onChildRemove:t.onChildRemove,addKey:t.addKey,removeKey:t.removeKey,alterKey:t.alterKey,errorMessage:t.errorMessage};if(o){var i=o.type;if("string"==typeof i){var u=e(i);return R(u,q({},a,{view:o}))}if("function"==typeof i){return R(i,q({},a,{view:o}))}}var s=Array.isArray(r.type)?r.type.find(function(t){return"null"!==t}):r.type,c=void 0;return c=e(void 0===s?"undefinedType":s),R(c,q({},a,{view:o||F}))}function o(t,e,n){return G.validate(t,e,{formValue:n})}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=[I].concat(e).concat([L]),o=t.select(r);n&&n.length&&Array.isArray(o.get())?(o.splice([0,o.get().length]),o.concat(n||[])):o.set(n||Q)}function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=new Map;n.forEach(function(t){var e=r.get(t.property)||[];e.push(t.message),r.set(t.property,e)}),a(t,e,Q),r.forEach(function(n,r){a(t,e.concat(r.split(/\.|\[|\]/).filter(function(t){return""!==t}).slice(1)),n)})}function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2],r=arguments[3],o=[I].concat(e);t.set([H].concat(e),n),t.set(o.concat([J]),"dirty"),i(t,e,r)}function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];t.set([H].concat(e),n),t.set([I].concat(e).concat([J]),"pristine")}function c(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.get([I].concat(e).concat([L]))||Q}function h(t){return t.get(H)}function p(t){return function(e){return R(t,q({},e,{errorMessage:e.dispatch(c,e.path),onChange:function(t){var n=o(t,e.schema,e.dispatch(h));e.onChange(t,n.errors)}}))}}function f(t){function e(t){if(r[t]){var e=r[t].index;if("number"==typeof e)return e}return 0}var n=[],r=t.schema.properties||{},o=t.value||{},a=Object.keys(r);Object.keys(o).forEach(function(t){t in r||a.push(t)}),a.sort(function(t,n){return e(t)-e(n)});for(var i=0;i<a.length;i+=1){var u=a[i];if(u in r)n.push(R(it,q({},t,{status:t.status[u]||X,schema:r[u],value:o[u],editKey:u,key:i})));else{var s=t.schema.additionalProperties;n.push(R(it,q({},t,{status:t.status[u]||X,schema:s,value:o[u],editKey:u,key:i})))}}return n}function l(t){return R(r,q({},t,{addKey:function(e,n){var r;if("object"===_(t.value)&&e in t.value)throw new Error('Property "'+e+'" already exists');t.onChange(Object.assign({},t.value,(r={},r[e]=n,r)))},removeKey:function(e){var n=Object.assign({},t.value);delete n[e],t.onChange(n)},alterKey:function(e,n){if(e!==n){if(n in t.value)throw new Error('Property "'+e+'" already exists');var r={};Object.keys(t.value).forEach(function(o){o!==e?r[o]=t.value[o]:r[n]=t.value[o]}),t.onChange(r)}}}),f(t))}function v(t){return R(r,t)}function y(t){return R(r,t)}function d(t,e){return function(n){var r=e.value;r?e.onChange(r.map(function(e,r){return+r!=+t?e:n})):e.onChange([n])}}function m(t){return function(e){var n=t.value||[];t.onChange(n.filter(function(t,n){return Number(n)!==Number(e)}))}}function g(t){return function(e){var n=t.value||[];t.onChange(n.concat([e]))}}function b(t){var e=t.value,n=t.schema,r=n.value,o=n.items,a=[];return(e||(r||[])).forEach(function(e,n){return a.push(R(it,q({},t,{schema:Array.isArray(o)?o[n]||{}:o,value:e,editKey:String(n),status:t.status[String(n)]||nt,key:n,onChange:d(n,t)})))}),a}function C(t){return R(r,q({},t,{onChildAdd:g(t),onChildRemove:m(t)}),b(t))}function w(t){return function(e){var n=e.schema.visible,r=e.value;try{if(n&&!n(r,e.dispatch(h),e.path.concat()))return null}catch(t){return null}return R(t,e)}}function K(t){return R("div",null,'Undefined field type "'+t.schema.type.toString()+'", ['+t.path.toString()+"]")}function j(t){switch(void 0===t?"undefined":_(t)){case"number":return"number";case"string":return"string";case"boolean":return"boolean";case"object":return Array.isArray(t)?"array":"object";default:return"string"}}function S(t,e){return void 0!==e?t.concat([e]):t}function A(t){return function(e){function n(t){V(this,n);var r=B(this,e.call(this,t)),o=t.schema||{};return"type"in o||(o=q({type:j(t.value)},o)),r.state={schema:o},r.path=S(r.props.path,r.props.editKey),r}return z(n,e),n.prototype.componentWillReceiveProps=function(t){if(t.editKey===this.props.editKey&&t.path===this.props.path||(this.path=S(t.path,t.editKey)),this.props.schema!==t.schema){var e=t.schema||{};"type"in e||(e=q({type:j(t.value)},e)),this.setState(function(){return{schema:e}})}},n.prototype.render=function(){return R(t,q({},this.props,{path:this.path,schema:this.state.schema}))},n}(D)}function O(t){var e=t.value,n=t.schema.value;return void 0!==e?e:n}function P(t){return function(e){function n(t){V(this,n);var r=B(this,e.call(this,t));return r.state={val:O(t)},r.notifyDefaultChange(),r}return z(n,e),n.prototype.componentDidMount=function(){},n.prototype.componentWillReceiveProps=function(t){void 0===t.status.state?this.setState({val:O(t)}):this.setState({val:t.value})},n.prototype.componentDidUpdate=function(){this.notifyDefaultChange()},n.prototype.notifyDefaultChange=function(){this.props.value!==this.state.val&&this.props.dispatch(s,this.props.path,this.state.val)},n.prototype.render=function(){return R(t,q({},this.props,{value:this.state.val}))},n}(D)}function E(){}import{Component as D,createElement as R}from"react";import{branch as x,root as N}from"baobab-react/higher-order";import k from"baobab";import{SchemaError as M,Validator as T}from"jsonschema";var W=function(){return new k({schema:{},value:{},status:{}})},U={},_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},q=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},z=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},B=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},F={},G=new T;G.attributes.errored=function(t,e,n){if("function"!=typeof e.errored)throw new M('"errored" expects a function');var r=e.errored(t,n.formValue);if(r)return r};var H="value",I="status",J="state",L="errors",Q=[],X={},Y=p(l),Z=p(v),$=function(t){function e(n){V(this,e);var r=B(this,t.call(this,n));return r.state={value:n.value},r.boundChange=r.onChange.bind(r),r}return z(e,t),e.prototype.componentWillReceiveProps=function(t){Number(this.state.value)!==Number(t.value)&&this.setState({value:t.value})},e.prototype.onChange=function(t){var e=this,n=""===t?void 0:t,r=Number(n);this.setState({value:n},function(){return e.props.onChange(isNaN(r)?n:r)})},e.prototype.render=function(){return R(v,q({},this.props,{value:this.state.value,onChange:this.boundChange}))},e}(D),tt=p($),et=p(y),nt={},rt=p(C),ot={object:Y,string:Z,number:tt,boolean:et,array:rt},at=function(t){function e(n){V(this,e);var r=B(this,t.call(this,n));return r.onChange=function(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];n.dispatch.apply(n,[u,r.props.path].concat(e))},r}return z(e,t),e.prototype.render=function(){var t=this.props.schema.type,e=Array.isArray(t)?t.find(function(t){return"null"!==t}):t,n=void 0;return n=void 0===e||"null"===e?K:ot[e],R(n,q({},this.props,{onChange:this.onChange}))},e}(D);at.defaultProps={path:[]};var it=A(P(w(at))),ut=x({schema:"schema",status:"status",value:"value"},it),st=function(t){function e(n){V(this,e);var r=B(this,t.call(this,n));return r.tree=W(),r.updateTree(n.value,n.schema),r.rooted=N(r.tree,ut),r}return z(e,t),e.prototype.componentDidMount=function(){var t=this;this.tree.select("value").on("update",function(e){t.event&&t.props.onChange(e.data.currentData,o(e.data.currentData,t.tree.get("schema"),e.data.currentData).errors)})},e.prototype.componentWillReceiveProps=function(t){t.value===this.tree.get("value")&&t.schema===this.props.schema||this.updateTree(t.value,t.schema)},e.prototype.componentWillUnmount=function(){this.tree.release()},e.prototype.shouldComponentUpdate=function(){return!1},e.prototype.getValue=function(){return this.tree.get("value")},e.prototype.updateTree=function(t,e){this.event=!1,this.tree.set("value",t),this.tree.set("schema",e),this.tree.set("status",{}),this.tree.commit(),this.event=!0},e.prototype.validate=function(){var t=o(this.tree.get("value"),this.tree.get("schema"),this.tree.get("value"));return i(this.tree,[],t.errors),t.errors},e.prototype.render=function(){var t=this.rooted;return R(t,{onChange:E,path:[]})},e}(D);st.defaultProps={schema:{}};export{n as setDefaultWidgets};export default st;
//# sourceMappingURL=index.es2015.js.map
